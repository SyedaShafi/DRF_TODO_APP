<!DOCTYPE html>
{% load static %}
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todo App</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <style>
      .container {
        margin-top: 50px;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
      <div class="container-fluid">
        <a class="navbar-brand" href="/">TODO App</a>
        {% if user.is_authenticated %}
        <a class="navbar-brand" id="listButton" href="{% url "list" %}">Todo List</a>
        
        {% endif %}
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div
          class="collapse navbar-collapse justify-content-end"
          id="navbarSupportedContent"
        >
        {% if user.is_authenticated %}
        
          <form onsubmit = "handlelogOut()">
              {% csrf_token %}
              <button
                id="logoutButton"
                class="btn btn-outline-danger m-2"
                type="submit"
              >
                Logout
              </button>
            </form>

        {% else  %}
        
          <form action="{% url "user_login" %}" >
            <button
              id="loginButton"
              class="btn btn-outline-success m-2"
              type="submit"
            >
              Login
            </button>
          </form>

          <form action="{% url "register" %}">
            <button
              id="signupButton"
              class="btn btn-outline-primary m-2"
              type="submit"
              >
              Sign Up
            </button>
          </form>
        
         {% endif %}
         

        </div>
      </div>
    </nav>

    <div class="container-fluid row justify-content-center align-items-center">
      <div class="col-md-6 text-center">
        <img
          src="{%static 'todo.jpg' %}"
          class="img-fluid rounded my-5"
          style="width: 550px; margin: auto"
          alt="TODO Image"
        />
      </div>
      <div class="col-md-6 text-center">
        Lorem ipsum dolor sit amet consectetur adipisicing elit. Ipsa, quos.
        Autem sint quibusdam nisi doloremque id. Error fugiat illum vitae
        praesentium ea dolorem. Lorem ipsum dolor sit amet consectetur
        adipisicing elit. Aliquid libero mollitia, consequatur consequuntur
        asperiores assumenda odit quis quam eaque? Natus recusandae fugiat at.
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <script>

       function getCookie(name) {
          var cookieValue = null;
          if (document.cookie && document.cookie !== '') {
              var cookies = document.cookie.split(';');
              for (var i = 0; i < cookies.length; i++) {
                  var cookie = cookies[i].trim();
                  // Check if the cookie contains the specified name
                  if (cookie.substring(0, name.length + 1) === (name + '=')) {
                      cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                      break;
                  }
              }
          }
          return cookieValue;
      }

      const handlelogOut = () => {
        const token = localStorage.getItem('token');

        fetch('https://drf-todo-app.onrender.com/clients/logout/', {
          method: 'GET',
          headers: {
            Authorization: `Token ${token}`,
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken'),
          },
        })
          .then((res) => {
           return res.json();
          })
          .then((data) => {
            alert("Logged Out Successfully!")
            localStorage.removeItem('token');
            localStorage.removeItem('user_id');
            window.location.href = '{% url "home" %}';
          });
      };
      

      
    </script>
  </body>
</html>